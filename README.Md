# API del Poder Judicial de la NaciÃ³n (PJN)

API RESTful para acceder y gestionar datos judiciales del Poder Judicial de la NaciÃ³n Argentina.

## ğŸ“‹ Tabla de contenidos

- [DescripciÃ³n](#descripciÃ³n)
- [InstalaciÃ³n](#instalaciÃ³n)
- [ConfiguraciÃ³n](#configuraciÃ³n)
- [Uso](#uso)
- [Endpoints](#endpoints)
- [Modelos](#modelos)
- [Estructura del proyecto](#estructura-del-proyecto)

## ğŸ“ DescripciÃ³n

Esta API proporciona acceso a datos de causas judiciales de diferentes fueros del Poder Judicial de la NaciÃ³n Argentina. Permite consultar, buscar y gestionar causas judiciales de los fueros Civil (CIV), Seguridad Social (CSS) y Trabajo (CNT).

## ğŸš€ InstalaciÃ³n

1. Clonar el repositorio:
   ```bash
   git clone <repositorio>
   cd pjn-api
   ```

2. Instalar dependencias:
   ```bash
   npm install
   ```

## âš™ï¸ ConfiguraciÃ³n

La aplicaciÃ³n utiliza variables de entorno para su configuraciÃ³n. Estas se cargan desde AWS Secrets Manager pero tambiÃ©n pueden configurarse localmente:

```bash
# Crear archivo .env local
touch .env

# Editar archivo y agregar variables
PORT=8083
URLDB=mongodb://localhost:27017/pjn
```

Variables de entorno requeridas:
- `PORT`: Puerto en el que se ejecutarÃ¡ el servidor (por defecto: 8083)
- `URLDB`: URL de conexiÃ³n a MongoDB

## ğŸ Uso

Para iniciar el servidor:

```bash
node src/server.js
```

La API estarÃ¡ disponible en `http://localhost:8083/api`

## ğŸŒ Endpoints

### Test de conexiÃ³n
- **GET** `/api/causas/test`
  - Verifica que el router de causas estÃ© funcionando
  - Respuesta: `{ message: 'Router de causas funcionando' }`

### Causas judiciales

Todos los endpoints de causas utilizan el parÃ¡metro `fuero` que puede ser:
- `CIV`: Fuero Civil
- `CSS`: Fuero de Seguridad Social
- `CNT`: Fuero del Trabajo

#### Consulta por nÃºmero y aÃ±o
- **GET** `/api/causas/:fuero/:number/:year`
  - Busca una causa especÃ­fica por su nÃºmero y aÃ±o
  - ParÃ¡metros de ruta:
    - `fuero`: Fuero judicial (CIV, CSS, CNT)
    - `number`: NÃºmero de causa
    - `year`: AÃ±o de la causa
  - Respuesta: Objeto con los datos de la causa o error 404 si no existe

#### Listado de objetos judiciales
- **GET** `/api/causas/:fuero/objetos`
  - Obtiene la lista de objetos judiciales disponibles para un fuero
  - ParÃ¡metros de ruta:
    - `fuero`: Fuero judicial (CIV, CSS, CNT)
  - Respuesta: Array de strings con los nombres de objetos judiciales

#### BÃºsqueda por objeto judicial
- **GET** `/api/causas/:fuero/buscar/objeto`
  - Busca causas por tipo de objeto judicial
  - ParÃ¡metros de ruta:
    - `fuero`: Fuero judicial (CIV, CSS, CNT)
  - ParÃ¡metros de consulta:
    - `objeto`: Texto del objeto judicial a buscar (parcial o completo)
  - Respuesta: Array de causas que coinciden con el objeto

#### BÃºsqueda avanzada
- **GET** `/api/causas/:fuero/buscar`
  - Realiza una bÃºsqueda avanzada de causas con mÃºltiples criterios
  - ParÃ¡metros de ruta:
    - `fuero`: Fuero judicial (CIV, CSS, CNT)
  - ParÃ¡metros de consulta:
    - `year`: AÃ±o de la causa (opcional)
    - `caratula`: Texto en la carÃ¡tula (opcional)
    - `juzgado`: Juzgado asignado (opcional)
    - `objeto`: Objeto de la causa (opcional)
  - Respuesta: Array de causas que cumplen con los criterios (mÃ¡ximo 100 resultados)

#### Agregar causa
- **POST** `/api/causas/:fuero/agregar`
  - Agrega una nueva causa o asocia un usuario a una causa existente
  - ParÃ¡metros de ruta:
    - `fuero`: Fuero judicial (CIV, CSS, CNT)
  - Cuerpo de la solicitud (JSON):
    - `number`: NÃºmero de causa (requerido)
    - `year`: AÃ±o de la causa (requerido)
    - `userId`: ID del usuario para asociar (opcional)
    - Otros datos de la causa (opcionales)
  - Respuesta: 
    - Si la causa existe y se proporciona userId: Asocia el usuario
    - Si la causa existe y no se proporciona userId: Devuelve los datos de la causa
    - Si la causa no existe: Crea una nueva causa

## ğŸ“Š Modelos

La API utiliza el paquete `pjn-models` que proporciona los siguientes modelos:

- **CausasCivil**: Causas del fuero civil
- **CausasSegSoc**: Causas del fuero de seguridad social
- **CausasTrabajo**: Causas del fuero laboral

Los modelos contienen campos como:
- `number`: NÃºmero de causa
- `year`: AÃ±o de la causa
- `fuero`: Fuero judicial (CIV, CSS, CNT)
- `caratula`: Nombre de la causa
- `objeto`: Objeto judicial
- `juzgado`: Juzgado asignado
- `userCausaIds`: Array de IDs de usuarios asociados
- `date`: Fecha de creaciÃ³n

## ğŸ“ Estructura del proyecto

```
/pjn-api
â”œâ”€â”€ README.md
â”œâ”€â”€ ecosystem.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ aws.js
â”‚   â”‚   â”œâ”€â”€ env.js
â”‚   â”‚   â””â”€â”€ pino.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ aws-ses.js
â”‚   â”‚   â””â”€â”€ causasController.js
â”‚   â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ causas-civil.js
â”‚   â”‚   â”œâ”€â”€ causas-ss.js
â”‚   â”‚   â””â”€â”€ causas-trabajo.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ causasRoutes.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ server.js
â”‚   â””â”€â”€ utils/
```

## ğŸ“§ EnvÃ­o de correos

La API incluye funcionalidad para enviar correos electrÃ³nicos mediante AWS SES:

```javascript
const { sendEmailController } = require('./controllers/aws-ses');

// Ejemplo de uso
const result = await sendEmailController(
  'destinatario@ejemplo.com',
  'Contenido del correo',
  'Asunto del correo',
  []  // Archivos adjuntos (opcional)
);
```

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la Licencia ISC.